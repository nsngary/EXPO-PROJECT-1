# 2026/01/02 開發日誌

## 將 git branch 命名正規化

改為使用:
    - main
    - feat/     `功能開發`
    - wip/      `開發未完成(暫存)`
    - experiment/       `實驗性項目`
    - chore/        `雜項`
    - debug/        `修正bug`

---

## feat/fix-root-routing 修正根目錄結構、將驗證流程對齊官方文件版本

1. 確認版本`npx expo --version`
   安裝 expo-secure-store `npx expo install expo-secure-store`

2. 建立`ctx.tsx`    [參考官方文件](https://docs.expo.dev/router/advanced/authentication/)
3. 建立`useStorageState.ts`     [參考官方文件](https://docs.expo.dev/router/advanced/authentication/)
4. 建立`splash.tsx`     [參考官方文件](https://docs.expo.dev/router/advanced/authentication/)
    **有 fonts 載入，要加[ready]    避免自行為載入就顯示UI，造成閃動**

5. 將建立(app)，並將原(tabs)及底下所有tab移動到(app底下)
6. 將 `sign-in.tsx` 與 `create-account.tsx`等改到 `app/` 根目錄

    ```bash
    app/
    sign-in.tsx
    (app)/
        _layout.tsx
        (tabs)/
        _layout.tsx
        index.tsx
        settings.tsx
        modal.tsx   // 若這個 modal 也要登入後才可開
    ```

7. 在根部_layout.tsx 加入 `SessionProvider` 與 `SplashScreenController`，使整個應用程式能夠存取身分驗證上下文。
    並在 `RootNavigator` 中以 Stack.Protected 來保護路由 sessionProvider

    ```typescript
    import { Stack } from 'expo-router';
    import { SessionProvider, useSession } from '../ctx';
    import { SplashScreenController } from '../splash';

    export default function Root() {

        return (
            <SessionProvider>
            <SplashScreenController />
            <RootNavigator />
            </SessionProvider>
        );
    }

    function RootNavigator() {
        const { session } = useSession();

        return (
            <Stack>
                <Stack.Protected guard={!!session}>
                    <Stack.Screen name="(app)" />
                </Stack.Protected>

                <Stack.Protected guard={!session}>
                    <StackScreen name="sign-in"/>
                    <StackScreen name="create-account"/>
                    <StackScreen name="forgot-password"/>
                </Stack.Protected>
            </Stack>
            );
    }
    ```

8. 實作登出功能：在 `profile/logout.tsx` 中 `import { useSession } from '@/ctx'`
   與宣告 Logout 來實現登出功能

    ```typescript
    const Logout = () => {
    const { signOut } = useSession();
    return (
        <View style={styles.container}>
            <Text
            style={styles.item}
            onPress={() => {
                signOut();
            }}>
            登出
            </Text>
        </View>
    )
    }
    ```
